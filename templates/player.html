<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PonyCanion - Reproductor Musical</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #FF3B30;
            --primary-dark: #D70015;
            --primary-light: #FF6B60;
            --dark: #0A0A0A;
            --darker: #050505;
            --dark-gray: #1A1A1A;
            --medium-gray: #2A2A2A;
            --light: #FFFFFF;
            --gray: #A0A0A0;
            --glass-bg: rgba(15, 15, 15, 0.98);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
       
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
       
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--darker);
            color: var(--light);
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container { 
            display: flex; 
            flex-direction: column;
            height: 100vh; 
            position: relative;
            overflow: hidden;
        }

        .app-header {
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            position: relative;
            z-index: 1001;
        }
       
        /* ========== MEN√ö M√ìVIL ========== */
        .mobile-header {
            display: none;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            height: 70px;
        }
        
        .mobile-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .mobile-header h1 {
            color: var(--light);
            font-size: 22px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .mobile-header h1 i {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 24px;
        }
        
        .mobile-menu-btn {
            background: rgba(255, 59, 48, 0.15);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: var(--primary);
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }
        
        .mobile-nav {
            display: none;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 20px;
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            z-index: 99;
            animation: slideDown 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .mobile-nav.active {
            display: block;
        }
        
        .mobile-nav-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .mobile-nav-item {
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            color: var(--gray);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid transparent;
            transition: var(--transition);
        }
        
        .mobile-nav-item.active {
            background: rgba(255, 59, 48, 0.15);
            color: var(--primary);
            border-color: rgba(255, 59, 48, 0.3);
        }
        
        .mobile-nav-item i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
       
        /* ========== SIDEBAR PC ========== */
        .sidebar {
            width: 280px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 40px;
            overflow-y: auto;
            z-index: 10;
            flex-shrink: 0;
            height: 100vh;
        }
       
        .logo { 
            padding: 0 10px; 
        }
        
        .logo h1 { 
            color: var(--light); 
            font-size: 28px; 
            font-weight: 800; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        
        .logo h1 i { 
            background: linear-gradient(to right, var(--primary), var(--primary-light)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-size: 32px; 
        }
        
        .logo .tagline {
            color: var(--gray);
            font-size: 13px;
            margin-top: 8px;
            padding-left: 45px;
        }
       
        .nav-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .nav-item {
            padding: 16px 20px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            gap: 18px;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
            font-size: 15px;
            position: relative;
        }
        
        .nav-item:hover { 
            background: rgba(255, 255, 255, 0.05); 
            color: var(--light); 
            transform: translateX(5px);
        }
        
        .nav-item.active { 
            background: rgba(255, 59, 48, 0.15); 
            color: var(--primary); 
            font-weight: 600; 
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 24px;
            background: var(--primary);
            border-radius: 2px;
        }
        
        .nav-item i { 
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
       
        .playlists-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
        }
        
        .playlists-section h3 {
            color: var(--gray);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 20px;
            padding: 0 20px;
            font-weight: 600;
        }
        
        #playlistsSidebar {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
       
        /* ========== CONTENIDO PRINCIPAL ========== */
        .main-content-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .main-content { 
            flex: 1; 
            padding: 30px 40px;
            overflow-y: auto; 
            position: relative;
            background: var(--dark);
            -webkit-overflow-scrolling: touch;
        }
        
        .content-header {
            padding: 0 0 30px 0;
            margin-bottom: 15px;
            position: sticky;
            top: 0;
            background: var(--dark);
            z-index: 10;
        }
        
        .search-container { 
            margin-bottom: 30px; 
            position: relative;
        }
       
        .search-box { 
            background: rgba(255, 255, 255, 0.07); 
            border: 1px solid rgba(255, 255, 255, 0.12); 
            border-radius: 16px; 
            padding: 5px 18px; 
            display: flex; 
            align-items: center; 
            width: 100%;
            max-width: 600px;
            transition: var(--transition);
            height: 56px;
        }
        
        .search-box:focus-within {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.2);
        }
        
        .search-box input { 
            flex: 1; 
            border: none; 
            background: transparent; 
            padding: 16px 10px; 
            font-size: 16px; 
            color: var(--light); 
            outline: none; 
        }
        
        .search-box input::placeholder {
            color: var(--gray);
        }
        
        .search-box button { 
            background: transparent; 
            border: none; 
            color: var(--gray); 
            cursor: pointer; 
            font-size: 18px; 
            padding: 10px;
            transition: var(--transition);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-box button:hover {
            background: rgba(255, 59, 48, 0.1);
            color: var(--primary);
        }
       
        .content-section { 
            display: none; 
            animation: fadeIn 0.4s ease; 
        }
        
        .content-section.active { 
            display: block; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
       
        .section-header { 
            display: flex; 
            flex-direction: column;
            gap: 15px;
            margin: 35px 0 25px; 
        }
        
        .section-header h2 { 
            font-size: 32px; 
            font-weight: 800; 
            background: linear-gradient(90deg, var(--light) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .section-header .subtitle {
            color: var(--gray);
            font-size: 15px;
        }
        
        .tracks-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
            gap: 24px; 
            padding-bottom: 40px;
        }
        
        .track-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .track-card:hover { 
            transform: translateY(-6px); 
            box-shadow: var(--shadow); 
            border-color: rgba(255, 59, 48, 0.3);
        }
        
        .track-card img { 
            width: 100%; 
            aspect-ratio: 1; 
            object-fit: cover; 
            border-radius: 12px; 
            margin-bottom: 18px; 
        }
        
        .track-card h4 { 
            font-size: 16px; 
            font-weight: 700; 
            margin-bottom: 8px; 
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .track-card p { 
            font-size: 14px; 
            color: var(--gray); 
            line-height: 1.4;
        }
        
        .track-card .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 59, 48, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
            border-radius: 16px;
        }
        
        .track-card:hover .play-overlay {
            opacity: 1;
        }
        
        .play-overlay i {
            font-size: 36px;
            color: white;
        }
       
        /* ========== PLAYER BAR - MOBILE OPTIMIZED ========== */
        .player-bar {
            position: fixed;
            bottom: 0; 
            left: 0; 
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border-top: 1px solid var(--glass-border);
            padding: 16px 40px;
            display: flex;
            align-items: center;
            gap: 30px;
            z-index: 1000;
            min-height: 100px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
        }
        
        /* Now Playing Section */
        .now-playing { 
            flex: 0 0 300px;
            display: flex; 
            align-items: center; 
            gap: 18px; 
            min-width: 0;
            max-width: 300px;
        }
        
        .now-playing img { 
            width: 60px; 
            height: 60px; 
            border-radius: 12px; 
            object-fit: cover; 
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            flex-shrink: 0;
        }
        
        .track-info { 
            min-width: 0;
            flex: 1;
            overflow: hidden;
        }
        
        .track-info h4 { 
            font-size: 16px; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .track-info p { 
            font-size: 13px; 
            color: var(--gray); 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }
       
        /* Player Controls */
        .player-controls { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px;
            min-width: 0;
        }
        
        .control-buttons { 
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 25px; 
            width: 100%;
        }
        
        .control-btn {
            background: transparent; 
            border: none; 
            color: var(--light); 
            font-size: 18px;
            cursor: pointer; 
            padding: 10px; 
            border-radius: 50%; 
            width: 44px; 
            height: 44px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover { 
            background: rgba(255,59,48,0.1); 
            color: var(--primary); 
            transform: scale(1.1);
        }
        
        .control-btn.active {
            background: rgba(255, 59, 48, 0.15);
            color: var(--primary);
        }
        
        .play-btn { 
            background: linear-gradient(to right, var(--primary), var(--primary-light)); 
            color: var(--light); 
            width: 52px; 
            height: 52px; 
            box-shadow: 0 4px 20px rgba(255, 59, 48, 0.4);
        }
        
        .play-btn:hover { 
            background: linear-gradient(to right, var(--primary-dark), var(--primary)); 
            transform: scale(1.1);
        }
       
        /* Progress Bar */
        .progress-bar { 
            width: 100%; 
            max-width: 600px;
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        
        .progress-time {
            font-size: 13px;
            color: var(--gray);
            min-width: 45px;
            font-weight: 500;
            flex-shrink: 0;
        }
        
        .progress-track { 
            flex: 1; 
            height: 4px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 3px; 
            cursor: pointer; 
            position: relative; 
            overflow: hidden;
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(to right, var(--primary), var(--primary-light)); 
            border-radius: 3px; 
            width: 0; 
            transition: width 0.1s linear; 
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background: var(--light);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .progress-track:hover .progress-fill::after {
            opacity: 1;
        }
       
        /* Volume Control */
        .volume-control { 
            flex: 0 0 180px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            min-width: 180px;
        }
        
        .volume-control input[type="range"] { 
            flex: 1; 
            height: 4px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 3px; 
            -webkit-appearance: none; 
            outline: none;
        }
        
        .volume-control input[type="range"]::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 14px; 
            height: 14px; 
            background: var(--primary); 
            border-radius: 50%; 
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 59, 48, 0.5);
            border: 2px solid white;
        }
        
        /* ========== NOTIFICACIONES ========== */
        .notification {
            position: fixed; 
            bottom: 120px; 
            left: 50%; 
            transform: translateX(-50%);
            background: var(--dark-gray); 
            color: white; 
            padding: 14px 24px; 
            border-radius: 14px;
            display: flex; 
            align-items: center; 
            gap: 10px; 
            box-shadow: var(--shadow);
            animation: slideUp 0.3s ease;
            z-index: 10000;
            border-left: 4px solid var(--primary);
            max-width: 90%;
            font-weight: 500;
            font-size: 14px;
        }
        
        @keyframes slideUp { 
            from { transform: translate(-50%,20px); opacity: 0; } 
            to { opacity: 1; } 
        }
       
        /* ========== MODALES ========== */
        #playlistModal, #apiKeyModal {
            display: none;
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(5,5,5,0.95); 
            backdrop-filter: blur(15px);
            z-index: 2000; 
            align-items: center; 
            justify-content: center;
            animation: fadeIn 0.3s;
            padding: 20px;
        }
        
        .playlist-modal-content, .modal-content {
            background: var(--dark); 
            border-radius: 20px; 
            width: 100%;
            max-width: 500px;
            max-height: 80vh; 
            overflow-y: auto; 
            padding: 25px; 
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }
        
        .playlist-item-modal {
            padding: 16px; 
            border-radius: 12px; 
            background: var(--dark-gray);
            margin-bottom: 10px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 16px;
            transition: var(--transition);
            border: 1px solid transparent;
        }
        
        .playlist-item-modal:hover { 
            background: var(--medium-gray); 
            border-color: rgba(255,59,48,0.3);
        }
        
        .playlist-item-modal.selected { 
            background: rgba(255, 59, 48, 0.15); 
            border: 1px solid var(--primary); 
        }
        
        .modal-content h2 {
            color: var(--light);
            margin-bottom: 10px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-content h2 i {
            color: var(--primary);
        }
        
        .modal-content p {
            color: var(--gray);
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .modal-input {
            width: 100%;
            padding: 14px 18px;
            background: var(--dark-gray);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--light);
            font-size: 15px;
            margin: 15px 0;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .modal-btn.primary {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
        }
        
        .modal-btn.secondary {
            background: var(--dark-gray);
            color: var(--light);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 59, 48, 0.3);
        }
        
        .api-key-protected {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255,59,48,0.05);
            border-radius: 12px;
            border: 1px dashed rgba(255,59,48,0.3);
            flex-direction: column;
            gap: 12px;
            text-align: center;
        }
        
        .api-key-protected i {
            font-size: 36px;
            color: var(--primary);
        }
        
        .show-api-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 13px;
        }
        
        .show-api-btn:hover {
            background: rgba(255,59,48,0.1);
        }
        
        /* ========== SCROLLBAR ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 59, 48, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 59, 48, 0.7);
        }
        
        /* ========== MEDIA QUERIES ========== */
        /* PC */
        @media (min-width: 1025px) {
            .app-container {
                flex-direction: row;
            }
            
            .mobile-header, .mobile-nav {
                display: none !important;
            }
        }
        
        /* Tablets */
        @media (max-width: 1024px) and (min-width: 769px) {
            .sidebar {
                width: 240px;
                padding: 25px 15px;
            }
            
            .main-content {
                padding: 25px 30px;
            }
            
            .tracks-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 20px;
            }
            
            .player-bar {
                padding: 15px 30px;
                gap: 25px;
                min-height: 90px;
            }
            
            .now-playing {
                flex: 0 0 250px;
                max-width: 250px;
            }
            
            .volume-control {
                flex: 0 0 150px;
                min-width: 150px;
            }
        }
        
        /* M√≥viles - PLAYER REDISE√ëADO */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .mobile-header {
                display: block;
            }
            
            .main-content-wrapper {
                flex-direction: column;
                height: calc(100vh - 70px - 140px);
                overflow: hidden;
            }
            
            .main-content {
                padding: 20px;
                height: 100%;
                overflow-y: auto;
            }
            
            .content-header {
                padding: 0;
                margin-bottom: 20px;
                position: sticky;
                top: 0;
                background: var(--dark);
                z-index: 10;
            }
            
            .search-container {
                padding: 0;
                margin-bottom: 20px;
            }
            
            .tracks-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 16px;
                padding-bottom: 30px;
            }
            
            .track-card {
                padding: 16px;
            }
            
            /* PLAYER MOBILE REDISE√ëADO */
            .player-bar {
                flex-direction: column;
                padding: 12px 20px;
                gap: 12px;
                min-height: 140px;
                height: auto;
            }
            
            .now-playing {
                order: 1;
                width: 100%;
                flex: 0 0 auto;
                max-width: 100%;
                justify-content: flex-start;
                margin-bottom: 10px;
            }
            
            .player-controls {
                order: 3;
                width: 100%;
                flex: 1;
                gap: 10px;
            }
            
            .volume-control {
                order: 2;
                width: 100%;
                flex: 0 0 auto;
                min-width: auto;
                justify-content: flex-start;
                margin-bottom: 10px;
            }
            
            .control-buttons {
                gap: 20px;
            }
            
            .control-btn {
                width: 42px;
                height: 42px;
                font-size: 17px;
                padding: 8px;
            }
            
            .play-btn {
                width: 50px;
                height: 50px;
            }
            
            .progress-bar {
                margin-top: 5px;
            }
            
            .progress-time {
                font-size: 12px;
                min-width: 40px;
            }
            
            .modal-content {
                padding: 25px;
                margin: 0 10px;
            }
            
            .mobile-nav {
                display: none;
            }
            
            .mobile-nav.active {
                display: block;
            }
        }
        
        /* M√≥viles peque√±os */
        @media (max-width: 480px) {
            .mobile-header {
                padding: 12px 15px;
                height: 65px;
            }
            
            .mobile-nav {
                top: 65px;
            }
            
            .mobile-header h1 {
                font-size: 20px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .search-box {
                height: 50px;
                padding: 5px 15px;
            }
            
            .tracks-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }
            
            .track-card {
                padding: 14px;
            }
            
            .section-header {
                margin: 30px 0 20px;
            }
            
            .section-header h2 {
                font-size: 24px;
            }
            
            .player-bar {
                padding: 10px 15px;
                min-height: 130px;
                gap: 10px;
            }
            
            .now-playing img {
                width: 50px;
                height: 50px;
            }
            
            .control-buttons {
                gap: 15px;
            }
            
            .control-btn {
                width: 40px;
                height: 40px;
                padding: 8px;
            }
            
            .play-btn {
                width: 46px;
                height: 46px;
            }
            
            .volume-control {
                gap: 10px;
            }
            
            .volume-control input[type="range"] {
                width: 120px;
            }
        }
        
        /* M√≥viles muy peque√±os */
        @media (max-width: 360px) {
            .tracks-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .track-card {
                padding: 12px;
            }
            
            .track-card h4 {
                font-size: 14px;
            }
            
            .control-buttons {
                gap: 12px;
            }
            
            .control-btn {
                width: 38px;
                height: 38px;
                font-size: 16px;
            }
            
            .play-btn {
                width: 44px;
                height: 44px;
            }
        }
        
        /* Modo landscape m√≥vil */
        @media (max-height: 600px) and (max-width: 768px) {
            .player-bar {
                min-height: 110px;
                padding: 8px 15px;
            }
            
            .main-content-wrapper {
                height: calc(100vh - 70px - 110px);
            }
            
            .now-playing img {
                width: 45px;
                height: 45px;
            }
            
            .control-btn {
                width: 36px;
                height: 36px;
            }
            
            .play-btn {
                width: 42px;
                height: 42px;
            }
        }
    </style>
</head>
<body>
    <!-- Header m√≥vil -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <h1><i class="fas fa-fire"></i> PonyCanion</h1>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
    
    <!-- Navegaci√≥n m√≥vil -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-items">
            <div class="mobile-nav-item active" onclick="loadSection('home'); toggleMobileMenu();">
                <i class="fas fa-home"></i><span>Inicio</span>
            </div>
            <div class="mobile-nav-item" onclick="loadSection('search'); toggleMobileMenu();">
                <i class="fas fa-search"></i><span>Buscar</span>
            </div>
            <div class="mobile-nav-item" onclick="loadSection('library'); toggleMobileMenu();">
                <i class="fas fa-music"></i><span>Tu m√∫sica</span>
            </div>
            <div class="mobile-nav-item" onclick="showAPIKeyModal(); toggleMobileMenu();">
                <i class="fas fa-key"></i><span>API Key</span>
            </div>
        </div>
    </div>
   
    <div class="app-container">
        <div class="app-header"></div>
        
        <!-- Sidebar para PC -->
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-fire"></i> PonyCanion</h1>
                <div class="tagline">Tu m√∫sica, a todo volumen</div>
            </div>
            <div class="nav-section">
                <div class="nav-item active" onclick="loadSection('home')">
                    <i class="fas fa-home"></i><span>Inicio</span>
                </div>
                <div class="nav-item" onclick="loadSection('search')">
                    <i class="fas fa-search"></i><span>Buscar</span>
                </div>
                <div class="nav-item" onclick="loadSection('library')">
                    <i class="fas fa-music"></i><span>Tu m√∫sica</span>
                </div>
                <div class="nav-item" onclick="showAPIKeyModal()">
                    <i class="fas fa-key"></i><span>API Key</span>
                </div>
            </div>
            <div class="playlists-section">
                <h3>Tus Playlists</h3>
                <div id="playlistsSidebar"></div>
            </div>
        </div>
       
        <div class="main-content-wrapper">
            <div class="main-content">
                <div class="content-header">
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="Busca canciones, artistas o √°lbumes...">
                            <button id="searchButton"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>
               
                <div id="homeSection" class="content-section active">
                    <div class="section-header">
                        <div>
                            <h2>Bienvenido de nuevo</h2>
                            <div class="subtitle">Tus canciones recientes y recomendaciones</div>
                        </div>
                    </div>
                    <div class="tracks-grid" id="recentGrid"></div>
                    
                    <div class="section-header">
                        <div>
                            <h2>Recomendaciones para ti</h2>
                            <div class="subtitle">Basado en tu actividad de escucha</div>
                        </div>
                    </div>
                    <div class="tracks-grid" id="recommendationsGrid"></div>
                </div>
               
                <div id="searchSection" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>Resultados de b√∫squeda</h2>
                            <div class="subtitle" id="searchStats">Escribe para buscar m√∫sica</div>
                        </div>
                    </div>
                    <div class="tracks-grid" id="searchResultsGrid"></div>
                </div>
               
                <div id="librarySection" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>Tu biblioteca</h2>
                            <div class="subtitle">Tus playlists y colecciones</div>
                        </div>
                        <button onclick="createPlaylist()" style="padding: 10px 20px; font-size: 14px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Nueva playlist
                        </button>
                    </div>
                    <div class="tracks-grid" id="playlistsGrid"></div>
                </div>
            </div>
        </div>
       
        <!-- Player Bar -->
        <div class="player-bar">
            <div class="now-playing">
                <img id="currentTrackImage" src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80" alt="Album">
                <div class="track-info">
                    <h4 id="currentTrackTitle">No hay canci√≥n seleccionada</h4>
                    <p id="currentTrackArtist">Selecciona una canci√≥n para comenzar</p>
                </div>
            </div>
           
            <div class="volume-control">
                <i class="fas fa-volume-up" id="volumeIcon"></i>
                <input type="range" id="volumeSlider" min="0" max="100" value="80">
            </div>
           
            <div class="player-controls">
                <div class="control-buttons">
                    <button class="control-btn" id="shuffleBtn">
                        <i class="fas fa-random"></i>
                    </button>
                    <button class="control-btn" id="previousBtn">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="control-btn play-btn" id="playPauseBtn">
                        <i class="fas fa-play" id="playPauseIcon"></i>
                    </button>
                    <button class="control-btn" id="nextBtn">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="control-btn" id="repeatBtn">
                        <i class="fas fa-redo" id="repeatIcon"></i>
                    </button>
                </div>
                <div class="progress-bar">
                    <span class="progress-time" id="currentTime">0:00</span>
                    <div class="progress-track" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="progress-time" id="totalTime">0:00</span>
                </div>
            </div>
        </div>
    </div>
   
    <!-- Modal API Key -->
    <div id="apiKeyModal">
        <div class="modal-content">
            <h2><i class="fas fa-key"></i> Configuraci√≥n de API</h2>
            <p>Configura tu API Key de YouTube para acceder a b√∫squedas reales. Sin API Key, la aplicaci√≥n funcionar√° en modo simulador.</p>
            
            <div class="api-key-protected" id="apiKeyProtectedSection">
                <i class="fas fa-lock"></i>
                <p>La API Key est√° protegida por seguridad</p>
                <button class="show-api-btn" onclick="revealAPIKeyField()">Mostrar campo API Key</button>
            </div>
            
            <div id="apiKeyFieldSection" style="display: none;">
                <input type="password" id="apiKeyInput" class="modal-input" placeholder="Pega tu API Key de YouTube aqu√≠">
                <div class="modal-buttons">
                    <button class="modal-btn primary" onclick="saveAPIKey()">Guardar API Key</button>
                    <button class="modal-btn secondary" onclick="hideAPIKeyModal()">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
   
    <!-- Modal Playlist -->
    <div id="playlistModal">
        <div class="playlist-modal-content">
            <h2 style="color:var(--primary); display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-list"></i> A√±adir a playlist
            </h2>
            <p id="modalTrackInfo" style="color:var(--gray);margin:15px 0; padding: 12px; background: var(--dark-gray); border-radius: 10px;"></p>
            <div id="modalPlaylistList"></div>
            
            <div style="margin:25px 0 15px;text-align:center;">
                <button onclick="showNewPlaylistForm()" class="modal-btn primary" style="padding: 12px 24px;">
                    <i class="fas fa-plus"></i> Crear nueva playlist
                </button>
            </div>
            
            <div id="newPlaylistForm" style="display:none;">
                <input type="text" id="newPlaylistName" class="modal-input" placeholder="Nombre de la nueva playlist">
                <button onclick="createAndAddPlaylist()" class="modal-btn primary" style="width:100%;">Crear y a√±adir</button>
            </div>
            
            <button onclick="closePlaylistModal()" class="modal-btn secondary" style="width:100%;margin-top:15px;">
                Cerrar
            </button>
        </div>
    </div>
   
    <!-- YouTube Player Container (INVISIBLE) -->
    <div id="youtubePlayerContainer" style="display: none; position: fixed; top: -1000px; left: -1000px; width: 0; height: 0;">
        <div id="youtubePlayer"></div>
    </div>
   
    <script>
        // ========== VARIABLES GLOBALES ==========
        let YOUTUBE_API_KEY = localStorage.getItem('ponycanion_youtube_api_key');
        let hasValidAPIKey = !!YOUTUBE_API_KEY;
        let searchNextPageToken = null;
        let searchLoading = false;
        let searchQuery = '';
       
        let currentTrack = null;
        let isPlaying = false;
        let youtubePlayer = null;
        let currentVideoId = '';
        let repeatMode = 0; // 0: no repeat, 1: repeat one, 2: repeat all
        let currentQueue = [];
        let shuffleActive = false;
        let playlists = {};
        let isMobileMenuOpen = false;
        let progressInterval = null;
        let userHasInteracted = false;
        let audioContext = null;

        // ========== INICIALIZACI√ìN ==========
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéµ PonyCanion iniciando...');
            
            // Verificar si hay API key en la URL
            const urlParams = new URLSearchParams(window.location.search);
            const apiKeyFromURL = urlParams.get('api_key');
            if (apiKeyFromURL) {
                YOUTUBE_API_KEY = apiKeyFromURL;
                localStorage.setItem('ponycanion_youtube_api_key', apiKeyFromURL);
                hasValidAPIKey = true;
                showNotification('API Key configurada desde URL', 'success');
            }
            
            setupEventListeners();
            loadInitialContent();
            loadPlaylists();
            renderPlaylistsSidebar();
            initializeYouTubePlayer();
            
            // Ajustar para m√≥vil
            adjustForMobile();
            
            // Mostrar modal de API Key si no hay una configurada
            if (!hasValidAPIKey && !apiKeyFromURL) {
                setTimeout(() => {
                    showAPIKeyModal();
                }, 1000);
            }
            
            showNotification(hasValidAPIKey ? 'API YouTube conectada ‚úÖ' : 'Modo simulador activado üî•', 'info');
            
            // Inicializar AudioContext para navegadores modernos
            initializeAudioContext();
        });

        // ========== AUDIO CONTEXT (PARA DESBLOQUEAR AUTOPLAY) ==========
        function initializeAudioContext() {
            try {
                if (window.AudioContext || window.webkitAudioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log('AudioContext inicializado');
                }
            } catch (error) {
                console.warn('No se pudo inicializar AudioContext:', error);
            }
        }

        // ========== RESPONSIVIDAD ==========
        function adjustForMobile() {
            const isMobile = window.innerWidth <= 768;
            const sidebar = document.querySelector('.sidebar');
            const mobileHeader = document.querySelector('.mobile-header');
            
            if (isMobile) {
                if (sidebar) sidebar.style.display = 'none';
                if (mobileHeader) mobileHeader.style.display = 'block';
            } else {
                if (sidebar) sidebar.style.display = 'flex';
                if (mobileHeader) mobileHeader.style.display = 'none';
                const mobileNav = document.getElementById('mobileNav');
                if (mobileNav) mobileNav.style.display = 'none';
            }
        }

        function toggleMobileMenu() {
            isMobileMenuOpen = !isMobileMenuOpen;
            const mobileNav = document.getElementById('mobileNav');
            if (mobileNav) {
                mobileNav.style.display = isMobileMenuOpen ? 'block' : 'none';
            }
        }

        window.addEventListener('resize', adjustForMobile);
        window.addEventListener('orientationchange', () => {
            setTimeout(adjustForMobile, 100);
        });

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Interacci√≥n del usuario para desbloquear audio
            document.addEventListener('click', function() {
                if (!userHasInteracted) {
                    userHasInteracted = true;
                    console.log('Usuario interactu√≥ - audio desbloqueado');
                    
                    // Resumir AudioContext si est√° suspendido
                    if (audioContext && audioContext.state === 'suspended') {
                        audioContext.resume().then(() => {
                            console.log('AudioContext resumido');
                        });
                    }
                    
                    showNotification('üîä Audio desbloqueado. Ahora puedes reproducir m√∫sica.', 'info');
                }
            });
            
            // B√∫squeda
            const searchButton = document.getElementById('searchButton');
            const searchInput = document.getElementById('searchInput');
            
            if (searchButton) {
                searchButton.addEventListener('click', performSearch);
            }
            
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
                
                // B√∫squeda en tiempo real con debounce
                let searchTimeout;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    if (e.target.value.trim().length > 2) {
                        searchTimeout = setTimeout(() => {
                            searchQuery = e.target.value.trim();
                            performSearch();
                        }, 500);
                    }
                });
            }
            
            // Controles del reproductor
            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
            document.getElementById('previousBtn').addEventListener('click', previousTrack);
            document.getElementById('nextBtn').addEventListener('click', nextTrack);
            document.getElementById('repeatBtn').addEventListener('click', toggleRepeat);
            document.getElementById('shuffleBtn').addEventListener('click', toggleShuffle);
            document.getElementById('progressBar').addEventListener('click', seekTrack);
            document.getElementById('volumeSlider').addEventListener('input', (e) => setVolume(e.target.value));
            
            // Scroll infinito para b√∫squeda
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.addEventListener('scroll', handleScroll);
            }
            
            // Prevenir carga de im√°genes rotas
            document.addEventListener('error', function(e) {
                if (e.target.tagName === 'IMG') {
                    if (e.target.src && e.target.src.includes('undefined')) {
                        e.target.src = 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80';
                    }
                }
            }, true);
        }

        // ========== B√öSQUEDA MEJORADA (SCROLL INFINITO) ==========
        async function performSearch() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            const query = searchInput.value.trim();
            if (!query) {
                showNotification('‚úèÔ∏è Escribe algo para buscar', 'warning');
                searchInput.focus();
                return;
            }
            
            searchQuery = query;
            searchNextPageToken = null;
            searchLoading = false;
            
            loadSection('search');
            
            const container = document.getElementById('searchResultsGrid');
            const stats = document.getElementById('searchStats');
            
            if (!container) return;
            
            // Mostrar estado de carga inicial
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: var(--gray);">
                    <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary);"></i>
                    <h3 style="margin: 20px 0 10px; color: var(--light);">Buscando "${query}"</h3>
                    <p>Buscando en ${hasValidAPIKey ? 'YouTube' : 'modo simulador'}...</p>
                </div>
            `;
            
            if (stats) {
                stats.textContent = 'Buscando...';
                stats.style.color = 'var(--primary)';
            }
            
            // Realizar b√∫squeda
            try {
                if (hasValidAPIKey) {
                    const results = await searchYouTubeReal(query);
                    if (results.items && results.items.length > 0) {
                        displaySearchResults(results.items, container, true);
                        searchNextPageToken = results.nextPageToken;
                        
                        if (stats) {
                            const total = results.pageInfo ? results.pageInfo.totalResults : results.items.length;
                            stats.textContent = `${total.toLocaleString()} resultados encontrados`;
                        }
                        showNotification(`‚úÖ Encontrados ${results.items.length} resultados`, 'success');
                    } else {
                        container.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: var(--gray);">
                                <i class="fas fa-search fa-3x" style="color: var(--primary);"></i>
                                <h3 style="margin: 20px 0 10px; color: var(--light);">No se encontraron resultados</h3>
                                <p>Intenta con otras palabras clave</p>
                            </div>
                        `;
                        if (stats) {
                            stats.textContent = 'No se encontraron resultados';
                        }
                    }
                } else {
                    const results = searchYouTubeSimulated(query);
                    displaySearchResults(results, container, true);
                    if (stats) {
                        stats.textContent = `${results.length} resultados (modo simulador)`;
                    }
                    showNotification('Usando modo simulador', 'info');
                }
            } catch (error) {
                console.error('Error en b√∫squeda:', error);
                const results = searchYouTubeSimulated(query);
                displaySearchResults(results, container, true);
                if (stats) {
                    stats.textContent = `${results.length} resultados (modo simulador)`;
                }
                showNotification('Error con API, usando modo simulador', 'error');
            }
        }

        async function searchYouTubeReal(query, pageToken = null) {
            if (!YOUTUBE_API_KEY) {
                throw new Error('No API Key');
            }
            
            let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query + ' m√∫sica')}&type=video&videoCategoryId=10&maxResults=50&key=${YOUTUBE_API_KEY}`;
            
            if (pageToken) {
                url += `&pageToken=${pageToken}`;
            }
            
            const response = await fetch(url);
            
            if (!response.ok) {
                if (response.status === 403) {
                    throw new Error('API Key no v√°lida o sin permisos.');
                }
                throw new Error(`Error ${response.status}`);
            }
            
            return await response.json();
        }

        async function loadMoreSearchResults() {
            if (!hasValidAPIKey || !searchNextPageToken || searchLoading) return;
            
            searchLoading = true;
            const container = document.getElementById('searchResultsGrid');
            const stats = document.getElementById('searchStats');
            
            // Mostrar spinner de carga
            const loadMoreIndicator = document.createElement('div');
            loadMoreIndicator.style.gridColumn = '1 / -1';
            loadMoreIndicator.style.textAlign = 'center';
            loadMoreIndicator.style.padding = '20px';
            loadMoreIndicator.innerHTML = `
                <i class="fas fa-spinner fa-spin" style="color: var(--primary);"></i>
                <span style="color: var(--gray); margin-left: 10px;">Cargando m√°s resultados...</span>
            `;
            container.appendChild(loadMoreIndicator);
            
            try {
                const results = await searchYouTubeReal(searchQuery, searchNextPageToken);
                
                if (results.items && results.items.length > 0) {
                    // Remover el indicador de carga
                    container.removeChild(loadMoreIndicator);
                    
                    displaySearchResults(results.items, container, false);
                    searchNextPageToken = results.nextPageToken;
                    
                    if (stats) {
                        const currentCount = container.querySelectorAll('.track-card').length;
                        stats.textContent = `${currentCount.toLocaleString()}+ resultados cargados`;
                    }
                }
            } catch (error) {
                console.error('Error cargando m√°s resultados:', error);
                // Remover el indicador de carga en caso de error
                if (loadMoreIndicator.parentNode === container) {
                    container.removeChild(loadMoreIndicator);
                }
            }
            
            searchLoading = false;
        }

        function displaySearchResults(items, container, clear = true) {
            if (clear) {
                container.innerHTML = '';
            }
            
            items.forEach(item => {
                let track;
                if (item.snippet) {
                    // Resultados reales de YouTube API
                    track = {
                        video_id: item.id.videoId || item.id,
                        title: item.snippet.title,
                        channel_title: item.snippet.channelTitle,
                        thumbnail: item.snippet.thumbnails?.medium?.url || item.snippet.thumbnails?.default?.url
                    };
                } else {
                    // Resultados simulados
                    track = {
                        video_id: item.video_id,
                        title: item.title,
                        channel_title: item.channel_title,
                        thumbnail: item.thumbnail
                    };
                }
                
                // Asegurar que la thumbnail no sea undefined
                const safeThumbnail = track.thumbnail || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80';
                
                const card = document.createElement('div');
                card.className = 'track-card';
                card.innerHTML = `
                    <img src="${safeThumbnail}" 
                         onerror="this.src='https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80'"
                         alt="${track.title}" 
                         loading="lazy">
                    <h4>${track.title}</h4>
                    <p>${track.channel_title || 'Artista'}</p>
                    <div class="play-overlay">
                        <i class="fas fa-play"></i>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    playTrack(track.video_id, track);
                });
                
                container.appendChild(card);
            });
        }

        function handleScroll() {
            const mainContent = document.querySelector('.main-content');
            const currentSection = document.querySelector('.content-section.active');
            
            if (currentSection && currentSection.id === 'searchSection' && mainContent) {
                const { scrollTop, scrollHeight, clientHeight } = mainContent;
                
                // Si estamos cerca del final (100px del fondo) y no estamos cargando
                if (scrollHeight - scrollTop - clientHeight < 100 && !searchLoading) {
                    loadMoreSearchResults();
                }
            }
        }

        function searchYouTubeSimulated(query) {
            const artists = ['Shakira', 'Bad Bunny', 'Taylor Swift', 'The Weeknd', 'Dua Lipa', 'Ed Sheeran', 'Karol G', 'Feid', 'Rosal√≠a', 'J Balvin'];
            const songTypes = ['Official Music Video', 'Lyrics Video', 'Live Performance', 'Acoustic Version', 'Remix 2024', 'Official Audio'];
            const genres = ['Pop', 'Rock', 'Reggaeton', 'Hip Hop', 'Electr√≥nica', 'Indie'];
            
            const fakeResults = [];
            const count = 50; // M√°s resultados en modo simulador
            
            for (let i = 0; i < count; i++) {
                const artist = artists[Math.floor(Math.random() * artists.length)];
                const songType = songTypes[Math.floor(Math.random() * songTypes.length)];
                const genre = genres[Math.floor(Math.random() * genres.length)];
                
                fakeResults.push({
                    video_id: 'sim_' + Date.now() + '_' + i,
                    title: `${query} - ${songType}`,
                    channel_title: `${artist} ‚Ä¢ ${genre}`,
                    thumbnail: `https://images.unsplash.com/photo-${1500000000000 + i}?w=400&h=400&fit=crop&q=80`
                });
            }
            
            return fakeResults;
        }

        // ========== REPRODUCCI√ìN CORREGIDA ==========
        function playTrack(videoId, trackInfo) {
            if (!trackInfo) return;
            
            currentTrack = trackInfo;
            currentVideoId = videoId;
            
            updatePlayerUI();
            
            // Si no hay interacci√≥n del usuario, mostrar mensaje
            if (!userHasInteracted) {
                showNotification('üëÜ Haz clic en cualquier parte de la pantalla para activar el audio', 'warning');
                return;
            }
            
            // Si hay API key y el reproductor est√° listo, usar YouTube
            if (hasValidAPIKey && youtubePlayer && youtubePlayer.loadVideoById) {
                try {
                    youtubePlayer.loadVideoById(videoId);
                    
                    // Peque√±a pausa para asegurar la carga
                    setTimeout(() => {
                        if (youtubePlayer.playVideo) {
                            youtubePlayer.playVideo();
                            isPlaying = true;
                            updatePlayPauseButton();
                            showNotification(`‚ñ∂Ô∏è Reproduciendo: ${trackInfo.title}`, 'success');
                        }
                    }, 800);
                    
                } catch (error) {
                    console.error('Error al reproducir con YouTube:', error);
                    simulateAudioPlayback();
                }
            } else {
                // Modo simulador
                simulateAudioPlayback();
            }
            
            // A√±adir a la cola si no est√°
            if (!currentQueue.some(t => t.video_id === videoId)) {
                currentQueue.push(trackInfo);
            }
        }

        function simulateAudioPlayback() {
            console.log('üé≠ Modo simulador activado');
            isPlaying = true;
            updatePlayPauseButton();
            simulateAudioProgress();
            showNotification(`üéµ Simulando reproducci√≥n: ${currentTrack?.title || 'Canci√≥n'}`, 'info');
        }

        function simulateAudioProgress() {
            if (progressInterval) clearInterval(progressInterval);
            
            let currentTime = 0;
            const totalTime = 180;
            
            document.getElementById('totalTime').textContent = formatTime(totalTime);
            
            progressInterval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(progressInterval);
                    return;
                }
                
                currentTime += 1;
                const progressPercent = (currentTime / totalTime) * 100;
                
                document.getElementById('progressFill').style.width = `${progressPercent}%`;
                document.getElementById('currentTime').textContent = formatTime(currentTime);
                
                if (currentTime >= totalTime) {
                    clearInterval(progressInterval);
                    handleTrackEnd();
                }
            }, 1000);
        }

        function handleTrackEnd() {
            isPlaying = false;
            updatePlayPauseButton();
            
            switch(repeatMode) {
                case 1: // Repeat one
                    if (youtubePlayer) {
                        youtubePlayer.seekTo(0);
                        youtubePlayer.playVideo();
                        isPlaying = true;
                        updatePlayPauseButton();
                    } else {
                        simulateAudioProgress();
                    }
                    break;
                case 2: // Repeat all
                    setTimeout(() => nextTrack(), 1000);
                    break;
            }
        }

        function togglePlayPause() {
            if (!currentTrack) {
                showNotification('üéµ Selecciona una canci√≥n primero', 'warning');
                return;
            }
            
            // Verificar interacci√≥n del usuario
            if (!userHasInteracted) {
                showNotification('üëÜ Haz clic en cualquier parte de la pantalla para activar el audio', 'warning');
                return;
            }
            
            if (youtubePlayer && hasValidAPIKey) {
                try {
                    if (isPlaying) {
                        youtubePlayer.pauseVideo();
                        isPlaying = false;
                        showNotification('‚è∏Ô∏è Pausado', 'info');
                    } else {
                        youtubePlayer.playVideo();
                        isPlaying = true;
                        showNotification('‚ñ∂Ô∏è Reproduciendo', 'success');
                    }
                    updatePlayPauseButton();
                } catch (error) {
                    console.error('Error controlando YouTube:', error);
                    simulateAudioControl();
                }
            } else {
                simulateAudioControl();
            }
        }

        function simulateAudioControl() {
            if (isPlaying) {
                isPlaying = false;
                if (progressInterval) clearInterval(progressInterval);
                showNotification('‚è∏Ô∏è Pausado (simulado)', 'info');
            } else {
                isPlaying = true;
                simulateAudioProgress();
                showNotification('‚ñ∂Ô∏è Reproduciendo (simulado)', 'info');
            }
            updatePlayPauseButton();
        }

        function previousTrack() {
            if (currentQueue.length === 0) return;
            
            const currentIndex = currentQueue.findIndex(t => t.video_id === currentVideoId);
            let prevIndex = currentIndex > 0 ? currentIndex - 1 : currentQueue.length - 1;
            
            if (currentQueue[prevIndex]) {
                const prevTrack = currentQueue[prevIndex];
                playTrack(prevTrack.video_id, prevTrack);
            }
        }

        function nextTrack() {
            if (currentQueue.length === 0) return;
            
            const currentIndex = currentQueue.findIndex(t => t.video_id === currentVideoId);
            let nextIndex = (currentIndex + 1) % currentQueue.length;
            
            if (currentQueue[nextIndex]) {
                const nextTrack = currentQueue[nextIndex];
                playTrack(nextTrack.video_id, nextTrack);
            }
        }

        function toggleRepeat() {
            repeatMode = (repeatMode + 1) % 3;
            const repeatBtn = document.getElementById('repeatBtn');
            const icon = document.getElementById('repeatIcon');
            
            // Quitar clase active primero
            repeatBtn.classList.remove('active');
            
            switch(repeatMode) {
                case 0:
                    icon.className = 'fas fa-redo';
                    repeatBtn.title = 'Repetir desactivado';
                    showNotification('üîÅ Repetici√≥n: Desactivada', 'info');
                    break;
                case 1:
                    icon.className = 'fas fa-redo';
                    repeatBtn.title = 'Repetir una canci√≥n';
                    repeatBtn.classList.add('active');
                    showNotification('üîÇ Repetici√≥n: Una canci√≥n', 'info');
                    break;
                case 2:
                    icon.className = 'fas fa-infinity';
                    repeatBtn.title = 'Repetir todas';
                    repeatBtn.classList.add('active');
                    showNotification('üîÅ Repetici√≥n: Todas', 'info');
                    break;
            }
        }

        function toggleShuffle() {
            shuffleActive = !shuffleActive;
            const shuffleBtn = document.getElementById('shuffleBtn');
            
            if (shuffleActive) {
                shuffleBtn.classList.add('active');
                shuffleBtn.style.color = 'var(--primary)';
                showNotification('üîÄ Modo aleatorio activado', 'info');
                
                // Mezclar la cola manteniendo la canci√≥n actual al principio
                if (currentQueue.length > 0) {
                    const currentIndex = currentQueue.findIndex(t => t.video_id === currentVideoId);
                    const currentTrackItem = currentQueue[currentIndex];
                    
                    const shuffled = [...currentQueue];
                    shuffled.splice(currentIndex, 1);
                    
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    
                    shuffled.unshift(currentTrackItem);
                    currentQueue = shuffled;
                }
            } else {
                shuffleBtn.classList.remove('active');
                shuffleBtn.style.color = '';
                showNotification('Modo aleatorio desactivado', 'info');
            }
        }

        function seekTrack(event) {
            if (!youtubePlayer || !currentTrack) return;
            
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickPosition = event.clientX - rect.left;
            const percentage = Math.max(0, Math.min(1, clickPosition / rect.width));
            const duration = youtubePlayer.getDuration();
            const newTime = duration * percentage;
            
            youtubePlayer.seekTo(newTime, true);
            
            // Actualizar visualmente
            document.getElementById('progressFill').style.width = `${percentage * 100}%`;
            document.getElementById('currentTime').textContent = formatTime(newTime);
        }

        function setVolume(value) {
            const volume = parseInt(value);
            const icon = document.getElementById('volumeIcon');
            
            if (volume === 0) {
                icon.className = 'fas fa-volume-mute';
            } else if (volume < 50) {
                icon.className = 'fas fa-volume-down';
            } else {
                icon.className = 'fas fa-volume-up';
            }
            
            if (youtubePlayer) {
                youtubePlayer.setVolume(volume);
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function updatePlayPauseButton() {
            const icon = document.getElementById('playPauseIcon');
            if (icon) {
                icon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
            }
        }

        function updatePlayerUI() {
            const titleEl = document.getElementById('currentTrackTitle');
            const artistEl = document.getElementById('currentTrackArtist');
            const imageEl = document.getElementById('currentTrackImage');
            
            if (titleEl) titleEl.textContent = currentTrack?.title || 'No hay canci√≥n seleccionada';
            if (artistEl) artistEl.textContent = currentTrack?.channel_title || 'Selecciona una canci√≥n para comenzar';
            if (imageEl) {
                const thumbnail = currentTrack?.thumbnail || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80';
                imageEl.src = thumbnail;
                imageEl.onerror = function() {
                    this.src = 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80';
                };
            }
        }

        // ========== NAVEGACI√ìN ==========
        function loadSection(section) {
            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNav = document.querySelector(`.nav-item[onclick*="${section}"]`);
            const activeMobileNav = document.querySelector(`.mobile-nav-item[onclick*="${section}"]`);
            
            if (activeNav) activeNav.classList.add('active');
            if (activeMobileNav) activeMobileNav.classList.add('active');
            
            // Cerrar men√∫ m√≥vil si est√° abierto
            if (window.innerWidth <= 768 && isMobileMenuOpen) {
                toggleMobileMenu();
            }
            
            // Mostrar secci√≥n
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            const targetSection = document.getElementById(`${section}Section`);
            if (targetSection) {
                targetSection.classList.add('active');
                
                if (section === 'search') {
                    setTimeout(() => {
                        const searchInput = document.getElementById('searchInput');
                        if (searchInput) {
                            searchInput.focus();
                            if (searchInput.value) searchInput.select();
                        }
                    }, 100);
                }
            }
        }

        // ========== CONTENIDO INICIAL ==========
        function loadInitialContent() {
            const recentTracks = [
                {
                    video_id: 'dQw4w9WgXcQ',
                    title: 'Never Gonna Give You Up',
                    channel_title: 'Rick Astley',
                    thumbnail: 'https://i.ytimg.com/vi/dQw4w9WgXcQ/mqdefault.jpg'
                },
                {
                    video_id: 'kJQP7kiw5Fk',
                    title: 'Despacito',
                    channel_title: 'Luis Fonsi ft. Daddy Yankee',
                    thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/mqdefault.jpg'
                },
                {
                    video_id: 'JGwWNGJdvx8',
                    title: 'Shape of You',
                    channel_title: 'Ed Sheeran',
                    thumbnail: 'https://i.ytimg.com/vi/JGwWNGJdvx8/mqdefault.jpg'
                },
                {
                    video_id: 'ru0K8uYEZWw',
                    title: 'Blinding Lights',
                    channel_title: 'The Weeknd',
                    thumbnail: 'https://i.ytimg.com/vi/ru0K8uYEZWw/mqdefault.jpg'
                }
            ];
            
            const recommendations = [
                {
                    video_id: 'TdrL3QxjyVw',
                    title: 'Bad Guy',
                    channel_title: 'Billie Eilish',
                    thumbnail: 'https://i.ytimg.com/vi/TdrL3QxjyVw/mqdefault.jpg'
                },
                {
                    video_id: '2Vv-BfVoq4g',
                    title: 'Perfect',
                    channel_title: 'Ed Sheeran',
                    thumbnail: 'https://i.ytimg.com/vi/2Vv-BfVoq4g/mqdefault.jpg'
                },
                {
                    video_id: '5qm8PH4xAss',
                    title: 'Dynamite',
                    channel_title: 'BTS',
                    thumbnail: 'https://i.ytimg.com/vi/5qm8PH4xAss/mqdefault.jpg'
                },
                {
                    video_id: 'k2qgadSvNyU',
                    title: 'Levitating',
                    channel_title: 'Dua Lipa',
                    thumbnail: 'https://i.ytimg.com/vi/k2qgadSvNyU/mqdefault.jpg'
                }
            ];
            
            // Usar funci√≥n displaySearchResults para mostrar contenido inicial
            displaySearchResults(recentTracks, document.getElementById('recentGrid'), true);
            displaySearchResults(recommendations, document.getElementById('recommendationsGrid'), true);
        }

        // ========== NOTIFICACIONES ==========
        function showNotification(message, type = 'info') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="${icon}" style="color: ${type === 'error' ? '#ff6b6b' : type === 'success' ? 'var(--primary)' : type === 'warning' ? '#ffc107' : 'var(--primary)'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translate(-50%, -20px)';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 3000);
        }

        // ========== YOUTUBE PLAYER (CORREGIDO) ==========
        function initializeYouTubePlayer() {
            // Si ya est√° cargado, crear el reproductor
            if (window.YT && window.YT.Player) {
                createYouTubePlayer();
                return;
            }
            
            // Configurar callback para cuando la API est√© lista
            window.onYouTubeIframeAPIReady = function() {
                console.log('YouTube API Ready');
                createYouTubePlayer();
            };
            
            // Cargar la API de YouTube
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            tag.async = true;
            document.body.appendChild(tag);
            
            // Timeout por si falla la carga
            setTimeout(() => {
                if (!youtubePlayer) {
                    console.warn('YouTube Player no se pudo inicializar. Usando modo simulador.');
                    showNotification('Reproductor de YouTube no disponible. Usando modo simulador.', 'warning');
                }
            }, 5000);
        }

        function createYouTubePlayer() {
            try {
                console.log('Creando reproductor de YouTube...');
                
                youtubePlayer = new YT.Player('youtubePlayer', {
                    height: '0',
                    width: '0',
                    videoId: '',
                    playerVars: {
                        'autoplay': 0,
                        'controls': 0,
                        'disablekb': 1,
                        'enablejsapi': 1,
                        'fs': 0,
                        'iv_load_policy': 3,
                        'modestbranding': 1,
                        'playsinline': 1,
                        'rel': 0,
                        'showinfo': 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
            } catch (error) {
                console.error('Error creando YouTube player:', error);
                showNotification('Error al crear reproductor de YouTube', 'error');
            }
        }

        function onPlayerReady(event) {
            console.log('YouTube Player Ready');
            event.target.setVolume(80);
            showNotification('Reproductor de YouTube listo ‚úÖ', 'success');
        }

        function onPlayerStateChange(event) {
            console.log('Estado del player:', event.data);
            
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                updatePlayPauseButton();
                
                const duration = event.target.getDuration();
                document.getElementById('totalTime').textContent = formatTime(duration);
                
                // Actualizar progreso continuamente
                const updateProgress = () => {
                    if (isPlaying && event.target.getCurrentTime) {
                        const currentTime = event.target.getCurrentTime();
                        const duration = event.target.getDuration();
                        const progressPercent = (currentTime / duration) * 100;
                        
                        document.getElementById('progressFill').style.width = `${progressPercent}%`;
                        document.getElementById('currentTime').textContent = formatTime(currentTime);
                        
                        if (isPlaying) {
                            requestAnimationFrame(updateProgress);
                        }
                    }
                };
                updateProgress();
                
            } else if (event.data === YT.PlayerState.PAUSED) {
                isPlaying = false;
                updatePlayPauseButton();
            } else if (event.data === YT.PlayerState.ENDED) {
                isPlaying = false;
                updatePlayPauseButton();
                handleTrackEnd();
            }
        }

        function onPlayerError(event) {
            console.error('Error en YouTube Player:', event.data);
            showNotification('Error al reproducir el video. Intenta con otra canci√≥n.', 'error');
            isPlaying = false;
            updatePlayPauseButton();
        }

        // ========== PLAYLIST FUNCTIONS ==========
        function loadPlaylists() {
            try {
                const stored = localStorage.getItem('ponycanion_playlists');
                if (stored) {
                    playlists = JSON.parse(stored);
                } else {
                    playlists = {
                        'fav': { id: 'fav', name: 'Favoritas ‚ù§Ô∏è', tracks: [] },
                        'chill': { id: 'chill', name: 'Chill üåô', tracks: [] },
                        'party': { id: 'party', name: 'Fiesta üéâ', tracks: [] }
                    };
                }
            } catch (error) {
                console.error('Error cargando playlists:', error);
                playlists = {
                    'fav': { id: 'fav', name: 'Favoritas ‚ù§Ô∏è', tracks: [] }
                };
            }
        }

        function savePlaylists() {
            localStorage.setItem('ponycanion_playlists', JSON.stringify(playlists));
        }

        function renderPlaylistsSidebar() {
            const container = document.getElementById('playlistsSidebar');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.values(playlists).forEach(playlist => {
                const item = document.createElement('div');
                item.className = 'nav-item';
                item.innerHTML = `
                    <i class="fas fa-list"></i>
                    <span>${playlist.name}</span>
                `;
                
                item.addEventListener('click', () => {
                    loadSection('library');
                    showPlaylistDetail(playlist.id);
                });
                
                container.appendChild(item);
            });
        }

        function createPlaylist() {
            const name = prompt('Nombre de la playlist:');
            if (name && name.trim()) {
                const id = 'pl_' + Date.now();
                playlists[id] = {
                    id: id,
                    name: name.trim(),
                    tracks: []
                };
                savePlaylists();
                renderPlaylistsSidebar();
                showNotification(`‚úÖ Playlist "${name}" creada`, 'success');
            }
        }

        function showPlaylistDetail(playlistId) {
            const playlist = playlists[playlistId];
            if (!playlist) return;
            
            const grid = document.getElementById('playlistsGrid');
            grid.innerHTML = `
                <div style="grid-column: 1 / -1; background: linear-gradient(135deg, var(--primary), var(--primary-light)); padding: 30px; border-radius: 12px; color: white;">
                    <h2 style="color:white;margin-bottom:10px;">${playlist.name}</h2>
                    <p style="color:rgba(255,255,255,0.9);">${playlist.tracks.length} canciones</p>
                </div>
            `;
            
            if (playlist.tracks.length === 0) {
                grid.innerHTML += `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-music fa-3x" style="color: var(--primary); opacity: 0.5;"></i>
                        <h3 style="margin: 20px 0 10px; color: var(--light);">Playlist vac√≠a</h3>
                        <p>A√±ade canciones para comenzar</p>
                    </div>
                `;
            } else {
                playlist.tracks.forEach(track => {
                    const card = document.createElement('div');
                    card.className = 'track-card';
                    card.innerHTML = `
                        <img src="${track.thumbnail}" 
                             onerror="this.src='https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=400&fit=crop&q=80'"
                             alt="${track.title}">
                        <h4>${track.title}</h4>
                        <p>${track.channel_title || 'Artista'}</p>
                        <div class="play-overlay">
                            <i class="fas fa-play"></i>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        currentQueue = [...playlist.tracks];
                        playTrack(track.video_id, track);
                    });
                    
                    grid.appendChild(card);
                });
            }
        }

        // ========== API KEY FUNCTIONS ==========
        function showAPIKeyModal() {
            const modal = document.getElementById('apiKeyModal');
            if (modal) {
                modal.style.display = 'flex';
                document.getElementById('apiKeyProtectedSection').style.display = 'flex';
                document.getElementById('apiKeyFieldSection').style.display = 'none';
            }
        }

        function revealAPIKeyField() {
            document.getElementById('apiKeyProtectedSection').style.display = 'none';
            document.getElementById('apiKeyFieldSection').style.display = 'block';
            
            const input = document.getElementById('apiKeyInput');
            if (input) {
                input.value = localStorage.getItem('ponycanion_youtube_api_key') || '';
                setTimeout(() => input.focus(), 100);
            }
        }

        function saveAPIKey() {
            const input = document.getElementById('apiKeyInput');
            if (!input) return;
            
            const apiKey = input.value.trim();
            if (!apiKey) {
                showNotification('‚ö†Ô∏è Por favor ingresa una API Key', 'warning');
                return;
            }
            
            localStorage.setItem('ponycanion_youtube_api_key', apiKey);
            YOUTUBE_API_KEY = apiKey;
            hasValidAPIKey = true;
            showNotification('‚úÖ API Key guardada correctamente', 'success');
            
            hideAPIKeyModal();
        }

        function hideAPIKeyModal() {
            const modal = document.getElementById('apiKeyModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>